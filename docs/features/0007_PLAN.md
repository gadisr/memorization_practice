# Feature 0007: Add Wide Moves Lw and Dw

## Brief Context

The current cube scrambling system only supports the six basic moves (U, R, F, B, D, L) with their variants (' and 2). The user requires adding two wide moves:

- **Lw**: Moves the left face + the center slice between R and L in the same direction as L
- **Dw**: Moves the down face + the center slice between U and D in the same direction as D

Both moves support variants: Lw', Lw2, Dw', Dw2.

These wide moves are essential for advanced cube solving algorithms and are already referenced in the setup moves documentation.

## Files and Functions to Modify

### 1. Type Definitions
**File**: `src/services/cube-scrambler.ts` (lines 31-33)
- Extend `Move` type to include 'Lw' and 'Dw'
- Update `FullMove` type to support wide move notation

### 2. Move Generation
**File**: `src/services/cube-scrambler.ts` (line 91)
- Add 'Lw' and 'Dw' to the moves array in `generate_scramble_sequence()`

### 3. Move Application Logic
**File**: `src/services/cube-scrambler.ts` (lines 132-169)
- Extend `apply_move()` function switch statement to handle Lw and Dw cases

### 4. Wide Move Implementation Functions
**File**: `src/services/cube-scrambler.ts`
- Add `move_Lw()` function - combines L move + M slice move (center between R and L)
- Add `move_Lw_prime()` function - combines L' move + M' slice move
- Add `move_Dw()` function - combines D move + E slice move (center between U and D)
- Add `move_Dw_prime()` function - combines D' move + E' slice move

### 5. Move Explanation
**File**: `src/services/cube-scrambler.ts` (lines 744-790)
- Extend `explain_move()` function switch statement to include Lw and Dw explanations

### 6. Documentation Update
**File**: `docs/cube_scrambling_guide.md`
- Add Lw and Dw moves to the Standard Move Notation section
- Document wide move behavior and affected pieces

## Algorithm Implementation

### Lw Move (Left Wide)
1. **Lw (clockwise)**: Execute L move + M slice move
   - Apply `move_L(cube)` 
   - Apply M slice move: rotate center slice between R and L clockwise
   - Affected pieces: L face + middle column of U, F, D, B faces

2. **Lw' (counter-clockwise)**: Execute L' move + M' slice move
   - Apply `move_L_prime(cube)`
   - Apply M' slice move: rotate center slice between R and L counter-clockwise

3. **Lw2 (180°)**: Execute Lw twice or L2 + M2

### Dw Move (Down Wide)
1. **Dw (clockwise)**: Execute D move + E slice move
   - Apply `move_D(cube)`
   - Apply E slice move: rotate center slice between U and D clockwise
   - Affected pieces: D face + middle row of F, R, B, L faces

2. **Dw' (counter-clockwise)**: Execute D' move + E' slice move
   - Apply `move_D_prime(cube)`
   - Apply E' slice move: rotate center slice between U and D counter-clockwise

3. **Dw2 (180°)**: Execute Dw twice or D2 + E2

### Slice Move Implementation
- **M slice**: Middle slice between R and L faces
  - Clockwise: U[1] → F[1] → D[1] → B[1] → U[1]
  - Counter-clockwise: U[1] → B[1] → D[1] → F[1] → U[1]

- **E slice**: Middle slice between U and D faces  
  - Clockwise: F[1] → R[1] → B[1] → L[1] → F[1]
  - Counter-clockwise: F[1] → L[1] → B[1] → R[1] → F[1]

### 7. Test Implementation
**File**: `src/services/cube-scrambler-test.ts`
- Add wide move tests to existing test functions
- Extend `test_individual_moves()` to include Lw and Dw variants
- Add wide move validation tests

**File**: `src/tests/consolidated-test-runner.ts` (lines 256-299)
- Add wide move tests to `runCubeScramblerTests()`
- Include wide move generation and application tests

**New Test File**: `src/tests/wide-moves.test.ts`
- Comprehensive wide move testing suite
- Slice move validation tests
- Wide move combination tests
- Edge case testing for wide moves

## Test Specifications

### Wide Move Test Categories

#### 1. Basic Wide Move Tests
- **Lw moves**: Test Lw, Lw', Lw2 application and effects
- **Dw moves**: Test Dw, Dw', Dw2 application and effects
- **Move validation**: Ensure wide moves produce valid cube states
- **Inverse testing**: Verify Lw + Lw' returns to solved state

#### 2. Slice Move Tests
- **M slice tests**: Validate center slice between R and L rotation
- **E slice tests**: Validate center slice between U and D rotation
- **Slice combinations**: Test M + M', E + E' return to solved state

#### 3. Integration Tests
- **Scramble generation**: Test wide moves in scramble sequences
- **Move explanations**: Validate wide move explanations are accurate
- **Edge tracing**: Ensure wide moves work with edge tracing system

#### 4. Edge Case Tests
- **Consecutive wide moves**: Test Lw Lw', Dw Dw' sequences
- **Mixed moves**: Test combinations of basic and wide moves
- **Complex sequences**: Test wide moves in complex algorithms

#### 5. Performance Tests
- **Wide move performance**: Ensure wide moves don't significantly impact performance
- **Large scramble tests**: Test wide moves in long scramble sequences

### Test Implementation Details

#### Wide Move Test Structure
```typescript
// Example test structure for wide moves
test('should apply Lw move correctly', () => {
  const cube = create_solved_cube();
  const initialState = get_cube_signature(cube);
  
  apply_move(cube, 'Lw');
  
  // Verify L face rotated + M slice rotated
  expect(cube.faces.L).toMatchSnapshot();
  expect(get_m_slice_colors(cube)).toMatchSnapshot();
});

test('should apply Dw move correctly', () => {
  const cube = create_solved_cube();
  apply_move(cube, 'Dw');
  
  // Verify D face rotated + E slice rotated
  expect(cube.faces.D).toMatchSnapshot();
  expect(get_e_slice_colors(cube)).toMatchSnapshot();
});
```

#### Slice Move Validation
```typescript
test('M slice should rotate center column correctly', () => {
  const cube = create_solved_cube();
  
  // Apply M slice move
  apply_m_slice(cube);
  
  // Verify middle column of U, F, D, B faces rotated
  expect(cube.faces.U.colors[1]).toEqual(['white', 'white', 'white']); // Should remain
  expect(cube.faces.F.colors[1]).toEqual(['green', 'green', 'green']); // Should remain
  // Verify edge pieces moved correctly
});

test('E slice should rotate center row correctly', () => {
  const cube = create_solved_cube();
  
  // Apply E slice move
  apply_e_slice(cube);
  
  // Verify middle row of F, R, B, L faces rotated
  // Verify edge pieces moved correctly
});
```

#### Wide Move Combination Tests
```typescript
test('Lw + Lw\' should return to solved state', () => {
  const cube = create_solved_cube();
  const initialState = get_cube_signature(cube);
  
  apply_move(cube, 'Lw');
  apply_move(cube, 'Lw\'');
  
  expect(get_cube_signature(cube)).toEqual(initialState);
});

test('Dw2 should be equivalent to Dw + Dw', () => {
  const cube1 = create_solved_cube();
  const cube2 = create_solved_cube();
  
  apply_move(cube1, 'Dw2');
  apply_move(cube2, 'Dw');
  apply_move(cube2, 'Dw');
  
  expect(get_cube_signature(cube1)).toEqual(get_cube_signature(cube2));
});
```

## Implementation Phases

### Phase 1: Type System Updates
- Update Move type to include 'Lw' | 'Dw'
- Ensure FullMove type supports wide move notation

### Phase 2: Core Move Implementation  
- Implement M and E slice move functions
- Implement Lw and Dw move functions with all variants
- Update apply_move() function to handle new moves

### Phase 3: Test Implementation
- Create comprehensive test suite for wide moves
- Implement slice move validation tests
- Add integration tests for wide moves in scrambles
- Create performance benchmarks for wide moves

### Phase 4: Integration and Documentation
- Update scramble generation to include wide moves
- Add move explanations for Lw and Dw
- Update documentation with wide move definitions
- Validate wide moves work with existing systems

Please do [docs/features/0007_PLAN.md]
