# Technical Plan: Corner Tracing and Edge Tracing Drills

## Brief Context

The user wants to add two new drill types to the BLD Memory Trainer application: **Corner Tracing** and **Edge Tracing**. These drills will present the solver with a scramble string (e.g., "U R R' U'") and require them to input the correct edge or corner sequence. The system validates the sequence and returns success or failure. The existing codebase already has robust corner and edge tracing services (`CornerTracer` and `EdgeTracer` classes) and scramble generation capabilities that can be integrated into the drill system.

## Current State Analysis

### Existing Infrastructure:
- ✅ `EdgeTracer` class with `do_full_trace()` method
- ✅ `CornerTracer` class with `do_full_trace()` method  
- ✅ `cube-scrambler.ts` with `generate_scramble_sequence()` and `scramble_cube()` functions
- ✅ `sequence-validator.ts` with comprehensive validation logic for edge tracing drills
- ✅ Existing drill types: `EDGE_NOTATION_DRILL`, `CORNER_NOTATION_DRILL`
- ✅ Session management and UI rendering systems

### Files to be Created:
- `src/ui/tracing-renderer.ts` - UI rendering for tracing drills
- `src/services/corner-tracing-validator.ts` - Corner tracing validation (similar to sequence-validator)

### Files to be Modified:
- `src/types.ts` - Add new drill types: `CORNER_TRACING_DRILL`, `EDGE_TRACING_DRILL`
- `src/config/drill-config.ts` - Add configurations for new drill types
- `src/app.ts` - Integrate tracing drills into main app logic

## Algorithm Step-by-Step

### Phase 1: Data Layer (Types and Configuration)

1. **Add New Drill Types**:
   - Add `CORNER_TRACING_DRILL = 'CORNER_TRACING_DRILL'` to `DrillType` enum
   - Add `EDGE_TRACING_DRILL = 'EDGE_TRACING_DRILL'` to `DrillType` enum

2. **Create Drill Configurations**:
   - Corner Tracing: Uses `QualityMetric.VIVIDNESS`, defaultPairCount: 1, description: "Trace corner cycles from scramble string"
   - Edge Tracing: Uses `QualityMetric.VIVIDNESS`, defaultPairCount: 1, description: "Trace edge cycles from scramble string"

### Phase 2A: Backend Services

3. **Edge Tracing Integration**:
   - Use existing `SequenceValidator` class for edge tracing validation
   - Methods: `validateDrillSequence()`, `scrambleAndValidate()` already available
   - Comprehensive validation with scoring, error detection, and feedback

4. **Corner Tracing Validator**:
   - Create `CornerTracingValidator` class similar to `SequenceValidator`
   - Methods: `validateCornerTracing()`, `scrambleAndValidateCorners()`
   - Use existing `CornerTracer.do_full_trace()` method
   - Handle corner-specific validation logic

5. **Integration with Existing Services**:
   - Use existing `generate_scramble_sequence()` from `cube-scrambler.ts`
   - Use existing `EdgeTracer.do_full_trace()` and `CornerTracer.do_full_trace()`
   - Integrate with existing session management system

### Phase 2B: UI Integration

6. **Tracing Renderer**:
   - Create UI components for displaying scramble strings
   - Input field for user's tracing result (letter sequence)
   - Real-time feedback and validation using existing `SequenceValidator`
   - Results display with accuracy metrics and detailed analysis

7. **App Logic Integration**:
   - Add tracing drill handling to existing session management
   - Create new screen for tracing drills
   - Integrate with existing drill selection system
   - Use existing `SequenceValidator.scrambleAndValidate()` for edge drills

## Implementation Details

### Tracing Drill Flow:
1. **Setup**: User selects Corner/Edge Tracing drill
2. **Session Start**: Generate random scramble using `generate_scramble_sequence()`, display to user
3. **User Input**: User enters their tracing result (letter sequence like "a b c d e f")
4. **Validation**: Compare with correct tracing using existing tracer services
5. **Results**: Show success/failure, accuracy, timing, and detailed feedback
6. **Storage**: Save session data for dashboard tracking

### Integration Points:
- **CornerTracer**: Use `do_full_trace()` method to get correct corner tracing
- **EdgeTracer**: Use `do_full_trace()` method to get correct edge tracing  
- **Cube Scrambler**: Use `generate_scramble_sequence()` and `scramble_cube()` functions
- **Session Storage**: Extend existing session storage for tracing data

### UI Components Needed:
- Scramble display area (large, clear text showing moves like "U R R' U'")
- Tracing input field (text area for letter sequences)
- Timer display
- Results feedback panel (success/failure with details)
- Navigation controls

### Validation Logic:
- Normalize user input (remove spaces, convert to uppercase)
- Compare with correct tracing result from tracer services
- Calculate accuracy percentage
- Identify specific errors (wrong letters, missing letters, extra letters)
- Provide detailed feedback on mistakes
- Return simple success/failure result

### Key Advantages of Existing Infrastructure:
- **Edge Tracing**: `SequenceValidator` already provides comprehensive validation with `scrambleAndValidate(scrambleString, userSequence)`
- **Scoring System**: Built-in scoring with detailed analysis and feedback
- **Error Detection**: Validates moves, checks cube state, identifies flipped edges
- **Integration Ready**: Already works with `EdgeTracer` and `cube-scrambler.ts`

### Implementation Strategy:
- **Edge Tracing Drills**: Use existing `SequenceValidator` directly - no new validation service needed
- **Corner Tracing Drills**: Create `CornerTracingValidator` following the same pattern as `SequenceValidator`
- **UI Components**: Create tracing renderer that integrates with existing validation services
- **Session Management**: Extend existing session system to handle tracing drill data

This plan leverages the existing robust validation infrastructure while adding the interactive drill functionality that integrates seamlessly with the current application architecture.
