# Technical Plan: Corner Tracing and Edge Tracing Drills

## Brief Context

The user wants to add two new drill types to the BLD Memory Trainer application: **Corner Tracing** and **Edge Tracing**. These drills will present the solver with a scramble string and require them to provide accurate tracing results. The existing codebase already has robust corner and edge tracing services (`CornerTracer` and `EdgeTracer` classes) that can perform full tracing on scrambled cube states. The goal is to integrate these services into the drill system to create interactive training sessions.

## Relevant Files and Functions

### Files to be Created:
- `src/services/tracing-session-manager.ts` - Session management for tracing drills
- `src/ui/tracing-renderer.ts` - UI rendering for tracing drills  
- `src/services/tracing-validator.ts` - Validation logic for tracing answers
- `src/services/scramble-generator.ts` - Generate random scrambles for drills

### Files to be Modified:
- `src/types.ts` - Add new drill types: `CORNER_TRACING_DRILL`, `EDGE_TRACING_DRILL`
- `src/config/drill-config.ts` - Add configurations for new drill types
- `src/app.js` - Integrate tracing drills into main app logic
- `public/index.html` - Add UI elements for tracing drills (if needed)

## Algorithm Step-by-Step

### Phase 1: Data Layer (Types and Configuration)

1. **Add New Drill Types**:
   - Add `CORNER_TRACING_DRILL = 'CORNER_TRACING_DRILL'` to `DrillType` enum
   - Add `EDGE_TRACING_DRILL = 'EDGE_TRACING_DRILL'` to `DrillType` enum

2. **Create Drill Configurations**:
   - Corner Tracing: Uses `QualityMetric.ACCURACY`, defaultPairCount: 1, description: "Trace corner cycles from scramble string"
   - Edge Tracing: Uses `QualityMetric.ACCURACY`, defaultPairCount: 1, description: "Trace edge cycles from scramble string"

### Phase 2A: Backend Services

3. **Scramble Generator Service**:
   - Create `generateRandomScramble()` function that returns valid scramble strings
   - Integrate with existing `cube-scrambler.ts` service
   - Generate scrambles of varying difficulty (5-15 moves)

4. **Tracing Session Manager**:
   - Create `TracingSessionManager` class similar to existing session managers
   - Methods: `createTracingSession()`, `getActiveTracingSession()`, `recordTracingAttempt()`, `finalizeTracingSession()`
   - Store session data: scramble string, user's tracing result, correct tracing result, timing

5. **Tracing Validator**:
   - Create validation logic to compare user's tracing with correct tracing
   - Handle different tracing formats (spaces, no spaces, case sensitivity)
   - Calculate accuracy metrics

### Phase 2B: UI Integration

6. **Tracing Renderer**:
   - Create UI components for displaying scramble strings
   - Input field for user's tracing result
   - Real-time feedback and validation
   - Results display with accuracy metrics

7. **App Logic Integration**:
   - Add tracing drill handling to `handleStartSession()` in `app.js`
   - Create new screen for tracing drills
   - Add keyboard shortcuts for tracing drills
   - Integrate with existing session management system

## Implementation Details

### Tracing Drill Flow:
1. **Setup**: User selects Corner/Edge Tracing drill
2. **Session Start**: Generate random scramble, display to user
3. **User Input**: User enters their tracing result (letter sequence)
4. **Validation**: Compare with correct tracing using existing tracer services
5. **Results**: Show accuracy, timing, and detailed feedback
6. **Storage**: Save session data for dashboard tracking

### Integration Points:
- **CornerTracer**: Use `do_full_trace()` method to get correct corner tracing
- **EdgeTracer**: Use `do_full_trace()` method to get correct edge tracing  
- **Cube Scrambler**: Use `scramble_cube()` to generate scrambled states
- **Session Storage**: Extend existing session storage for tracing data

### UI Components Needed:
- Scramble display area (large, clear text)
- Tracing input field (text area for letter sequences)
- Timer display
- Progress indicator
- Results feedback panel
- Navigation controls

### Validation Logic:
- Normalize user input (remove spaces, convert to uppercase)
- Compare with correct tracing result
- Calculate accuracy percentage
- Identify specific errors (wrong letters, missing letters, extra letters)
- Provide detailed feedback on mistakes

This plan leverages the existing robust tracing infrastructure while adding the interactive drill functionality that integrates seamlessly with the current application architecture.
