# Corner Tracing Feature Plan

## Brief Context
Implement corner tracing functionality based on the existing edge tracer implementation. Corners use uppercase notation (A-X) instead of lowercase letters (a-x) used for edges. The corner tracer will follow the same algorithmic approach as the edge tracer but adapted for 3-color corner pieces instead of 2-color edge pieces.

## Files and Functions to be Created/Modified

### New Files to Create:
- `src/services/corner-tracer.ts` - Main corner tracer implementation
- `src/tests/corner-tracer.test.ts` - Test suite for corner tracer
- `docs/corner_tracing.txt` - Documentation for corner tracing algorithm

### Files to Modify:
- `src/services/edge-tracer.ts` - Add shared types and interfaces
- `package.json` - Add any new dependencies if needed

## Algorithm Implementation

### Phase 1: Data Layer and Types
1. **Create CornerTracer class** with similar structure to EdgeTracer:
   - `cornerNotation: Map<string, [string, string, string]>` - Maps uppercase letters to 3 colors
   - `cubePositions: Map<string, Position3D>` - Maps corner positions to 3D coordinates
   - `correlateMap: Map<string, string[]>` - Maps corner to its 3 possible orientations

2. **Define corner notation data** (24 corners, uppercase A-X):
   - Each corner has 3 colors in specific order
   - Map each corner letter to its 3 colors
   - Define position mappings for all 8 corners on the cube

3. **Update shared interfaces**:
   - Extend `CubeState` interface to handle 3-color pieces
   - Create `CornerState` interface for corner-specific data

### Phase 2A: Core Corner Tracer Logic
1. **Load corner notation** - Similar to `loadEdgeNotation()` but for 3 colors
2. **Load corner positions** - Map uppercase letters to cube positions (embedded in class)
3. **Load correlate map** - Handle 3 possible orientations per corner
4. **Implement core methods**:
   - `get_corner_solved_position_by_colors(colors: [string, string, string]): string`
   - `get_secondary_corner_letters(notation: string): string[]` - Returns 2 additional letters (total 3 orientations)
   - `get_colors_by_letter(positionLetter: string, scrambledCube: CornerState): [string, string, string]`
   - `is_position_included(positionLetter: string, lettersList: string[]): boolean`
   - `is_corner_flipped(positionLetter: string, cube: CornerState): boolean`
   - `is_in_position(notationLetter: string, cube: CornerState): boolean`

### Phase 2B: Cycle and Tracing Logic
1. **Implement cycle tracing**:
   - `do_cycle(positionLetter: string, cube: CornerState, includeLastLetter: boolean): [string, string[]]`
   - Handle 3-color corner pieces in cycle detection
   - Manage 3 possible orientations per corner

2. **Implement full tracing**:
   - `do_full_trace(cube: CornerState): string`
   - Use uppercase buffer position (likely "B" instead of "b")
   - Handle all 24 corner positions (A-X)
   - Filter out already-solved corners

3. **Add helper methods**:
   - `createSolvedCornerState(): CornerState`
   - `getAllCornerPositions(): string[]`
   - `extractCornerColorsFromCube(cubeState: any): CornerState`

### Phase 3: Testing and Integration
1. **Create comprehensive test suite**:
   - Test solved cube state
   - Test scrambled cube scenarios
   - Test edge cases (flipped corners, cycles)
   - Test position mapping accuracy

2. **Add export function**:
   - `export function traceCorners(cubeState: CornerState): string`

## Key Differences from Edge Tracer

1. **3 colors per piece** instead of 2 colors
2. **Uppercase notation** (A-X) instead of lowercase (a-x)
3. **3 possible orientations** per corner instead of 2 for edges (get_secondary_corner_letters returns 2 additional letters)
4. **8 corner positions** instead of 12 edge positions
5. **Different buffer position** (likely "B" instead of "b")
6. **More complex orientation handling** due to 3-color nature
7. **All data embedded in class** - no separate data files needed

## Technical Considerations

1. **Color ordering matters** - Must maintain consistent color order for each corner
2. **Orientation detection** - Need to handle 3 possible orientations per corner
3. **Position mapping** - Each corner touches 3 faces, need accurate 3D coordinates
4. **Cycle detection** - Must account for 3 possible orientations in cycle tracing
5. **Buffer management** - Handle uppercase buffer position and its correlates

Please do [docs/features/0005_PLAN.md]
