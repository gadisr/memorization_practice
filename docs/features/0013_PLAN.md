# Feature 0013: Progress Graphs for Drill Improvement Visualization

## Brief Context

The user wants to add graphs to display improvement in drills. Currently, the application has a dashboard with basic statistics (total sessions, average accuracy, average speed) and a table showing recent sessions. The user wants visual progress tracking through graphs that show improvement trends over time for key metrics like accuracy, speed, vividness, and flow across different drill types.

## Current State Analysis

### Existing Infrastructure:
- ✅ Dashboard with basic statistics (`src/ui/renderer.ts` - `renderDashboardStats()`)
- ✅ Session data storage with comprehensive metrics (`SessionData` interface)
- ✅ Drill type tracking and categorization
- ✅ Time-series data available (session dates, metrics per session)
- ✅ Both regular sessions and notation sessions tracked
- ✅ Quality metrics: Vividness (1-5) and Flow (1-3) based on drill type

### Available Data Points:
- **Session Data**: `date`, `drillType`, `averageTime`, `recallAccuracy`, `vividness`, `flow`, `pairCount`
- **Notation Data**: `date`, `drillType`, `accuracy`, `averageTime`, `correctCount`, `totalPieces`
- **Time Range**: All historical sessions with timestamps
- **Drill Types**: 8 different drill types with different metrics

## Phase 1: Data Layer & Chart Library Integration

### 1.1 Chart Library Selection

**Chart.js Integration:**
- **Library**: Chart.js (lightweight, responsive, mobile-friendly)
- **CDN**: Load from CDN to avoid build complexity
- **Features**: Line charts, bar charts, responsive design
- **Compatibility**: Works with existing TypeScript setup

### 1.2 Data Processing Functions

**File:** `src/services/chart-data-processor.ts`

**Functions to create:**
- `processAccuracyData(sessions: SessionData[], notationSessions: NotationSessionData[]): ChartData`
- `processSpeedData(sessions: SessionData[], notationSessions: NotationSessionData[]): ChartData`
- `processQualityData(sessions: SessionData[]): ChartData`
- `processDrillTypeComparison(sessions: SessionData[], notationSessions: NotationSessionData[]): ChartData`
- `filterSessionsByDateRange(sessions: SessionData[], days: number): SessionData[]`
- `groupSessionsByDrillType(sessions: SessionData[]): Map<DrillType, SessionData[]>`

## Phase 2A: Chart Components & UI Integration

### 2.1 Chart Component Creation

**File:** `src/ui/chart-renderer.ts`

**Chart Components:**
- `AccuracyProgressChart` - Line chart showing accuracy over time
- `SpeedProgressChart` - Line chart showing average time per pair over time  
- `QualityTrendChart` - Line chart showing vividness/flow over time
- `DrillTypeComparisonChart` - Bar chart comparing performance across drill types
- `WeeklyProgressChart` - Bar chart showing weekly averages

### 2.2 Chart Configuration

**Chart.js Configuration:**
- **Responsive Design**: Charts scale to container size
- **Color Scheme**: Consistent with app theme (blue, green, orange, red)
- **Animation**: Smooth transitions for better UX
- **Tooltips**: Show detailed data on hover
- **Legend**: Clear drill type identification

## Phase 2B: Dashboard Enhancement

### 2.3 Dashboard Layout Update

**File:** `public/index.html` - Dashboard section

**New Dashboard Layout:**
```html
<div class="dashboard-content">
  <div class="stats-grid">
    <!-- Existing stat cards -->
  </div>
  
  <div class="charts-section">
    <div class="chart-controls">
      <select id="time-range-select">
        <option value="7">Last 7 days</option>
        <option value="30">Last 30 days</option>
        <option value="90">Last 90 days</option>
        <option value="all">All time</option>
      </select>
      <select id="drill-filter-select">
        <option value="all">All Drills</option>
        <option value="flash">Flash Pairs</option>
        <option value="chain">Chain Drills</option>
        <option value="notation">Notation Drills</option>
      </select>
    </div>
    
    <div class="charts-grid">
      <div class="chart-container">
        <h3>Accuracy Progress</h3>
        <canvas id="accuracy-chart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Speed Progress</h3>
        <canvas id="speed-chart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Quality Trends</h3>
        <canvas id="quality-chart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Drill Comparison</h3>
        <canvas id="comparison-chart"></canvas>
      </div>
    </div>
  </div>
  
  <!-- Existing sessions table -->
</div>
```

### 2.4 Chart Styling

**File:** `public/styles.css` - Add chart styles

**CSS Classes:**
- `.charts-section` - Main charts container
- `.chart-controls` - Filter controls styling
- `.charts-grid` - Grid layout for charts
- `.chart-container` - Individual chart wrapper
- `.chart-container canvas` - Chart canvas styling

## Phase 3: Chart Implementation & Data Processing

### 3.1 Chart Data Processing Algorithm

**Accuracy Progress Chart:**
1. Group sessions by date (daily aggregation)
2. Calculate average accuracy per day
3. Handle both regular sessions (recallAccuracy) and notation sessions (accuracy)
4. Create line chart with date on x-axis, accuracy % on y-axis

**Speed Progress Chart:**
1. Group sessions by date (daily aggregation)  
2. Calculate average time per pair per day
3. Handle both regular sessions (averageTime) and notation sessions (averageTime)
4. Create line chart with date on x-axis, seconds on y-axis

**Quality Trends Chart:**
1. Filter sessions by drill type (vividness vs flow)
2. Group by date and calculate average quality score
3. Separate lines for vividness drills vs flow drills
4. Create multi-line chart showing both metrics

**Drill Type Comparison:**
1. Group sessions by drill type
2. Calculate average metrics per drill type
3. Create bar chart comparing performance across drill types

### 3.2 Chart Rendering Functions

**File:** `src/ui/chart-renderer.ts`

**Functions:**
- `renderAccuracyChart(sessions: SessionData[], notationSessions: NotationSessionData[]): void`
- `renderSpeedChart(sessions: SessionData[], notationSessions: NotationSessionData[]): void`
- `renderQualityChart(sessions: SessionData[]): void`
- `renderDrillComparisonChart(sessions: SessionData[], notationSessions: NotationSessionData[]): void`
- `updateChartsWithFilters(timeRange: string, drillFilter: string): void`

## Files to Create:

1. **`src/services/chart-data-processor.ts`** - Data processing for charts
2. **`src/ui/chart-renderer.ts`** - Chart rendering components
3. **`src/types/chart.ts`** - Chart-related type definitions

## Files to Modify:

1. **`public/index.html`** - Add chart containers and controls to dashboard
2. **`public/styles.css`** - Add chart styling
3. **`src/ui/renderer.ts`** - Integrate chart rendering with dashboard
4. **`src/app.ts`** - Add chart initialization and event handlers

## Dependencies to Add:

```json
{
  "chart.js": "^4.4.0"
}
```

## Chart Types & Metrics:

### 1. Accuracy Progress (Line Chart)
- **X-axis**: Date
- **Y-axis**: Accuracy percentage
- **Data**: Daily average accuracy across all drill types
- **Color**: Blue line with gradient fill

### 2. Speed Progress (Line Chart)  
- **X-axis**: Date
- **Y-axis**: Average time per pair (seconds)
- **Data**: Daily average speed across all drill types
- **Color**: Green line with gradient fill

### 3. Quality Trends (Multi-line Chart)
- **X-axis**: Date
- **Y-axis**: Quality score (1-5 for vividness, 1-3 for flow)
- **Data**: Separate lines for vividness drills vs flow drills
- **Colors**: Orange for vividness, Purple for flow

### 4. Drill Type Comparison (Bar Chart)
- **X-axis**: Drill types
- **Y-axis**: Average accuracy percentage
- **Data**: Average performance per drill type
- **Colors**: Different color per drill type

## Technical Considerations:

1. **Performance**: Process data efficiently for large session histories
2. **Responsiveness**: Charts adapt to different screen sizes
3. **Data Filtering**: Real-time chart updates when filters change
4. **Empty States**: Handle cases with no data gracefully
5. **Mobile Optimization**: Touch-friendly chart interactions

## User Experience:

### Dashboard Enhancement:
- **Visual Progress**: Users can see improvement trends at a glance
- **Drill Comparison**: Identify which drills are most/least effective
- **Time Range Filtering**: Focus on recent progress or long-term trends
- **Quality Insights**: Track vividness and flow improvements separately

### Chart Interactions:
- **Hover Details**: Show exact values on hover
- **Filter Controls**: Change time range and drill type filters
- **Responsive Design**: Charts work on mobile and desktop
- **Smooth Animations**: Professional chart transitions

The implementation will provide users with clear visual feedback on their training progress, helping them identify improvement patterns and optimize their practice routine.
