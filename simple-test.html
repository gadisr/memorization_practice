<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Cube Scrambler Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #1a1a1a;
            color: #ffffff;
            margin: 20px;
            line-height: 1.4;
        }
        .output {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #444;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .clear-btn {
            background-color: #f44336;
        }
        .clear-btn:hover {
            background-color: #da190b;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #2e7d32; }
        .error { background-color: #c62828; }
    </style>
</head>
<body>
    <h1>üßä Simple Cube Scrambler Test</h1>
    
    <div id="status" class="status">Loading...</div>
    
    <button onclick="runTest()">üß™ Run Test</button>
    <button onclick="runExample()">üìã Run Example</button>
    <button onclick="testMoves()">üîÑ Test Individual Moves</button>
    <button onclick="testRotations()">üîÑ Test Rotation Variants</button>
    <button onclick="testSpecific()">üîç Test Specific Moves</button>
    <button onclick="testWideMoves()">üî≤ Test Wide Moves</button>
    <button onclick="testWideEdgeTracing()">üî≤üîó Test Wide + Edge Tracing</button>
    <button onclick="testEdgeTracing()">üîó Test Edge Tracing</button>
    <button onclick="testCornerTracing()">üî≤ Test Corner Tracing</button>
    <button onclick="clearOutput()" class="clear-btn">üóëÔ∏è Clear</button>
    
    <div id="output" class="output">Click "Run Test" to see the cube scrambler in action...</div>

    <script type="module">
        const outputDiv = document.getElementById('output');
        const statusDiv = document.getElementById('status');
        
        // Override console.log to display in the page
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            outputDiv.textContent += args.join(' ') + '\n';
            outputDiv.scrollTop = outputDiv.scrollHeight;
        };
        
        let scramblerModule = null;
        
        // Load the module
        async function loadModule() {
            try {
                statusDiv.textContent = 'Loading cube scrambler module...';
                statusDiv.className = 'status';
                
                scramblerModule = await import('./dist/services/cube-scrambler.js');
                
                statusDiv.textContent = '‚úÖ Module loaded successfully!';
                statusDiv.className = 'status success';
                console.log('üöÄ Cube Scrambler loaded and ready!');
                
            } catch (error) {
                statusDiv.textContent = `‚ùå Error loading module: ${error.message}`;
                statusDiv.className = 'status error';
                console.log('‚ùå Failed to load module:', error);
            }
        }
        
        // Test basic functionality
        async function runTest() {
            try {
                console.log('\n=== üß™ BASIC FUNCTIONALITY TEST ===');
                
                if (!scramblerModule) {
                    throw new Error('Module not loaded');
                }
                
                // Test scramble generation
                const scramble = scramblerModule.generate_scramble_sequence(10);
                console.log(`üìù Generated scramble: ${scramble.join(' ')}`);
                console.log(`üî¢ Total moves: ${scramble.length}`);
                
                // Test cube scrambling
                const scrambledCube = scramblerModule.scramble_cube(scramble);
                console.log('‚úÖ Cube scrambled successfully!');
                
                // Test cube printing
                console.log('\nüé≤ Scrambled cube:');
                scramblerModule.print_cube(scrambledCube);
                
                console.log('\n‚úÖ Basic functionality test completed!');
                
            } catch (error) {
                console.log('‚ùå Test failed:', error);
            }
        }
        
        // Run example
        async function runExample() {
            try {
                console.log('\n=== üìã EXAMPLE USAGE ===');
                
                if (!scramblerModule) {
                    throw new Error('Module not loaded');
                }
                
                scramblerModule.example_usage();
                
            } catch (error) {
                console.log('‚ùå Example failed:', error);
            }
        }
        
        // Test individual moves
        async function testMoves() {
            try {
                console.log('\n=== üîÑ INDIVIDUAL MOVES TEST ===');
                
                if (!scramblerModule) {
                    throw new Error('Module not loaded');
                }
                
                scramblerModule.test_individual_moves();
                
            } catch (error) {
                console.log('‚ùå Individual moves test failed:', error);
            }
        }
        
        // Test rotation variants
        async function testRotations() {
            try {
                console.log('\n=== üîÑ ROTATION VARIANTS TEST ===');
                
                if (!scramblerModule) {
                    throw new Error('Module not loaded');
                }
                
                scramblerModule.test_rotation_variants();
                
            } catch (error) {
                console.log('‚ùå Rotation variants test failed:', error);
            }
        }
        
        // Test specific moves
        async function testSpecific() {
            try {
                console.log('\n=== üîç SPECIFIC MOVES TEST ===');
                
                if (!scramblerModule) {
                    throw new Error('Module not loaded');
                }
                
                scramblerModule.test_specific_moves();
                
            } catch (error) {
                console.log('‚ùå Specific moves test failed:', error);
            }
        }
        
        // Test wide moves functionality
        async function testWideMoves() {
            try {
                console.log('\n=== üî≤ WIDE MOVES TEST ===');
                
                if (!scramblerModule) {
                    throw new Error('Module not loaded');
                }
                
                // Test wide move explanations
                console.log('\nüìù Wide Move Explanations:');
                console.log('\nLw (Left Wide):');
                console.log(scramblerModule.explain_move('Lw'));
                console.log('\nLw\' (Left Wide Prime):');
                console.log(scramblerModule.explain_move('Lw\''));
                console.log('\nLw2 (Left Wide Double):');
                console.log(scramblerModule.explain_move('Lw2'));
                console.log('\nDw (Down Wide):');
                console.log(scramblerModule.explain_move('Dw'));
                console.log('\nDw\' (Down Wide Prime):');
                console.log(scramblerModule.explain_move('Dw\''));
                console.log('\nDw2 (Down Wide Double):');
                console.log(scramblerModule.explain_move('Dw2'));
                
                // Test wide move application
                console.log('\nüîÑ Testing Wide Move Application:');
                
                // Test Lw moves
                console.log('\n--- Testing Lw moves ---');
                const cube1 = scramblerModule.scramble_cube('Lw');
                console.log('‚úÖ Lw applied successfully');
                
                const cube2 = scramblerModule.scramble_cube('Lw Lw\'');
                console.log('‚úÖ Lw + Lw\' applied successfully (should return to solved state)');
                
                const cube3 = scramblerModule.scramble_cube('Lw2');
                console.log('‚úÖ Lw2 applied successfully');
                
                // Test Dw moves
                console.log('\n--- Testing Dw moves ---');
                const cube4 = scramblerModule.scramble_cube('Dw');
                console.log('‚úÖ Dw applied successfully');
                
                const cube5 = scramblerModule.scramble_cube('Dw Dw\'');
                console.log('‚úÖ Dw + Dw\' applied successfully (should return to solved state)');
                
                const cube6 = scramblerModule.scramble_cube('Dw2');
                console.log('‚úÖ Dw2 applied successfully');
                
                // Test mixed wide and basic moves
                console.log('\n--- Testing Mixed Moves ---');
                const cube7 = scramblerModule.scramble_cube('R Lw U Dw\' F2');
                console.log('‚úÖ Mixed wide and basic moves applied successfully');
                
                // Test wide moves in scramble generation
                console.log('\n--- Testing Wide Moves in Scrambles ---');
                for (let i = 0; i < 5; i++) {
                    const scramble = scramblerModule.generate_scramble_sequence(20);
                    const hasWideMoves = scramble.split(' ').some(move => move.startsWith('Lw') || move.startsWith('Dw'));
                    console.log(`Scramble ${i + 1}: ${scramble} ${hasWideMoves ? '(contains wide moves)' : '(basic moves only)'}`);
                }
                
                console.log('\n‚úÖ Wide moves test completed successfully!');
                
            } catch (error) {
                console.log('‚ùå Wide moves test failed:', error);
            }
        }
        
        // Test wide moves with edge tracing functionality
        async function testWideEdgeTracing() {
            try {
                console.log('\n=== üî≤üîó WIDE MOVES + EDGE TRACING TEST ===');
                
                if (!scramblerModule) {
                    throw new Error('Scrambler module not loaded');
                }
                
                // Test specific wide move sequences
                const wideMoveSequences = [
                    'Lw Dw Lw\' Dw\'',  // Wide moves that should return to solved
                    'R Lw U Dw\' F2',   // Mixed wide and basic moves
                    'Lw2 Dw2',          // Wide double moves
                    'Lw Dw Lw\' Dw\' Lw2 Dw2'  // Complex wide sequence
                ];
                
                for (let i = 0; i < wideMoveSequences.length; i++) {
                    const sequence = wideMoveSequences[i];
                    console.log(`\n--- Test ${i + 1}: "${sequence}" ---`);
                    
                    // Apply wide move sequence
                    const cube = scramblerModule.scramble_cube(sequence);
                    console.log(`‚úÖ Applied sequence: ${sequence}`);
                    
                    // Load edge tracer
                    const edgeTracerModule = await import('./dist/services/edge-tracer.js');
                    const edgeTracer = new edgeTracerModule.EdgeTracer();
                    
                    // Extract edge colors
                    const cubeState = edgeTracer.extractEdgeColorsFromCube(cube);
                    
                    // Run edge tracing
                    const tracingString = edgeTracer.do_full_trace(cubeState);
                    
                    console.log(`üìù Edge tracing result: "${tracingString}"`);
                    if (tracingString.trim() === "") {
                        console.log('‚úÖ No cycles needed - wide moves returned to solved state!');
                    } else {
                        console.log('üîÑ Cycles found - wide moves created scrambled state');
                    }
                }
                
                // Test wide moves in random scrambles
                console.log('\n--- Testing Wide Moves in Random Scrambles ---');
                for (let i = 0; i < 3; i++) {
                    const scramble = scramblerModule.generate_scramble_sequence(25);
                    const wideMoves = scramble.split(' ').filter(move => move.startsWith('Lw') || move.startsWith('Dw'));
                    
                    console.log(`\nScramble ${i + 1}: ${scramble}`);
                    console.log(`Wide moves: ${wideMoves.length > 0 ? wideMoves.join(', ') : 'None'}`);
                    
                    // Apply scramble and trace
                    const cube = scramblerModule.scramble_cube(scramble);
                    const edgeTracerModule = await import('./dist/services/edge-tracer.js');
                    const edgeTracer = new edgeTracerModule.EdgeTracer();
                    const cubeState = edgeTracer.extractEdgeColorsFromCube(cube);
                    const tracingString = edgeTracer.do_full_trace(cubeState);
                    
                    console.log(`Edge tracing: "${tracingString}"`);
                }
                
                console.log('\n‚úÖ Wide moves + edge tracing test completed successfully!');
                
            } catch (error) {
                console.log('‚ùå Wide moves + edge tracing test failed:', error);
            }
        }
        
        // Test edge tracing functionality
        async function testEdgeTracing() {
            try {
                console.log('\n=== üîó EDGE TRACING TEST (WITH WIDE MOVES) ===');
                
                if (!scramblerModule) {
                    throw new Error('Scrambler module not loaded');
                }
                
                // Generate a scramble (will include wide moves)
                const scramble = scramblerModule.generate_scramble_sequence(20);
                console.log(`üìù Scramble sequence: ${scramble}`);
                console.log(`üî¢ Total moves: ${scramble.split(' ').length}`);
                
                // Check if scramble contains wide moves
                const wideMoves = scramble.split(' ').filter(move => move.startsWith('Lw') || move.startsWith('Dw'));
                if (wideMoves.length > 0) {
                    console.log(`üî≤ Wide moves found: ${wideMoves.join(', ')}`);
                } else {
                    console.log('üìù No wide moves in this scramble (basic moves only)');
                }
                
                // Apply scramble to cube
                const scrambledCube = scramblerModule.scramble_cube(scramble);
                
                // Print the actual scrambled cube faces
                console.log('\nüé≤ Scrambled cube faces:');
                scramblerModule.print_cube(scrambledCube);
                
                // Load the edge tracer module
                console.log('\nüé≤ Extracting edge pieces from scrambled cube...');
                const edgeTracerModule = await import('./dist/services/edge-tracer.js');
                const edgeTracer = new edgeTracerModule.EdgeTracer();
                
                // Use the EdgeTracer method to extract edge colors
                const scrambledCubeState = edgeTracer.extractEdgeColorsFromCube(scrambledCube);
                
                // Print cube colors before tracing
                console.log('\nüìä Cube state before tracing:');
                const allPositions = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 
                                     'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x'];
                allPositions.forEach(pos => {
                    if (scrambledCubeState[pos]) {
                        console.log(`  ${pos}: ${scrambledCubeState[pos].colors[0]}-${scrambledCubeState[pos].colors[1]}`);
                    }
                });
                
                // Use the EdgeTracer's built-in full trace method
                console.log('\nüîÑ Running full edge tracing algorithm...');
                const tracingString = edgeTracer.do_full_trace(scrambledCubeState);
                
                // Display final results
                console.log('\nüéØ FINAL EDGE TRACING RESULTS:');
                console.log(`üìù Complete tracing string: "${tracingString}"`);
                console.log(`üìä Total cycles found: ${tracingString.trim().split(' ').filter(s => s).length} pieces`);
                
                if (tracingString.trim() === "") {
                    console.log('‚úÖ No cycles needed - cube is solved!');
                } else {
                    console.log('üîÑ Cycles found - cube needs solving');
                }
                
                console.log('\n‚úÖ Edge tracing completed successfully!');
                
            } catch (error) {
                console.log('‚ùå Edge tracing test failed:', error);
            }
        }
        
        // Test corner tracing functionality
        async function testCornerTracing() {
            try {
                console.log('\n=== üî≤ CORNER TRACING TEST ===');
                
                if (!scramblerModule) {
                    throw new Error('Scrambler module not loaded');
                }
                
                // Generate a scramble
                const scramble = scramblerModule.generate_scramble_sequence(15);
                console.log(`üìù Scramble sequence: ${scramble}`);
                console.log(`üî¢ Total moves: ${scramble.split(' ').length}`);
                
                // Apply scramble to cube
                const scrambledCube = scramblerModule.scramble_cube(scramble);
                
                // Print the actual scrambled cube faces
                console.log('\nüé≤ Scrambled cube faces:');
                scramblerModule.print_cube(scrambledCube);
                
                // Load the corner tracer module
                console.log('\nüé≤ Extracting corner pieces from scrambled cube...');
                const cornerTracerModule = await import('./dist/services/corner-tracer.js');
                const cornerTracer = new cornerTracerModule.CornerTracer();
                
                // Use the CornerTracer method to extract corner colors
                const scrambledCubeState = cornerTracer.extractCornerColorsFromCube(scrambledCube);
                
                // Print cube colors before tracing
                console.log('\nüìä Cube state before tracing:');
                const allPositions = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
                allPositions.forEach(pos => {
                    if (scrambledCubeState[pos]) {
                        console.log(`  ${pos}: ${scrambledCubeState[pos].colors[0]}-${scrambledCubeState[pos].colors[1]}-${scrambledCubeState[pos].colors[2]}`);
                    }
                });
                
                // Use the CornerTracer's built-in full trace method
                console.log('\nüîÑ Running full corner tracing algorithm...');
                const tracingString = cornerTracer.do_full_trace(scrambledCubeState);
                
                // Display final results
                console.log('\nüéØ FINAL CORNER TRACING RESULTS:');
                console.log(`üìù Complete tracing string: "${tracingString}"`);
                console.log(`üìä Total cycles found: ${tracingString.trim().split(' ').filter(s => s).length} pieces`);
                
                if (tracingString.trim() === "") {
                    console.log('‚úÖ No cycles needed - cube is solved!');
                } else {
                    console.log('üîÑ Cycles found - cube needs solving');
                }
                
                console.log('\n‚úÖ Corner tracing completed successfully!');
                
            } catch (error) {
                console.log('‚ùå Corner tracing test failed:', error);
            }
        }
        
        // Clear output
        function clearOutput() {
            outputDiv.textContent = '';
        }
        
        // Make functions available globally
        window.runTest = runTest;
        window.runExample = runExample;
        window.testMoves = testMoves;
        window.testRotations = testRotations;
        window.testSpecific = testSpecific;
        window.testWideMoves = testWideMoves;
        window.testWideEdgeTracing = testWideEdgeTracing;
        window.testEdgeTracing = testEdgeTracing;
        window.testCornerTracing = testCornerTracing;
        window.clearOutput = clearOutput;
        
        // Load the module when page loads
        loadModule();
    </script>
</body>
</html>